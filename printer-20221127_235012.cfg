#  Klipper master config file.
#  Uses multiple other config files.
#
#    _  __ ____      _     _  __    _   _____   _    _   _
#   | |/ /|  _ \    / \   | |/ /   / \ |_   _| / \  | | | |
#   | ' / | |_) |  / _ \  | ' /   / _ \  | |  / _ \ | | | |
#   | . \ |  _ <  / ___ \ | . \  / ___ \ | | / ___ \| |_| |
#   |_|\_\|_| \_\/_/   \_\|_|\_\/_/   \_\|_|/_/   \_\\___/
#
#               /777          ((_           ___
#              (o o)         (o o)         (o o)
#          ooO--(_)--Ooo-ooO--(_)--Ooo-ooO--(_)--Ooo
#

[save_variables]
filename:
  ~/variables.cfg
#   Required - provide a filename that would be used to save the
#   variables to disk e.g. ~/variables.cfg

# Machine definitions
[include machine.cfg]

# Macro definitions
[include macros.cfg]

# Bed definitions
[include bed.cfg]

[include print_area_bed_mesh.cfg]

# Cura Material Settings
[include cura_settings.cfg]

# My Buttons
[include my_buttons.cfg]

[pause_resume]

[display_status]

[virtual_sdcard]
path: ~/gcode_files

[skew_correction]

[endstop_phase]

[respond]

[idle_timeout]
gcode:
  TURN_OFF_HEATERS
  M84
  RESPOND PREFIX=tgalarm MSG="Idle Timeout"
  timeout = 900


#BambuStudio #######################################################

[gcode_arcs]
resolution: 0.1

[gcode_macro _M201]
gcode:
  {% if 'X' in params or 'Y' in params %}
    {% set accel = (params.X|default(params.Y)|float,
                    params.Y|default(params.X)|float)|min %}
      SET_VELOCITY_LIMIT ACCEL={accel} ACCEL_TO_DECEL={accel * 0.5}
  {% else %}
    SET_VELOCITY_LIMIT
  {% endif %}

[gcode_macro _M203]
gcode:
  {% if 'X' in params or 'Y' in params %}
    {% set speed = (params.X|default(params.Y)|float,
                       params.Y|default(params.X)|float)|min %}
    SET_VELOCITY_LIMIT VELOCITY={speed}
  {% else %}
    SET_VELOCITY_LIMIT
  {% endif %}

[gcode_macro _M205]
gcode:
  {% if 'X' in params or 'Y' in params %}
    {% set corner_speed = (params.X|default(params.Y)|float,
                       params.Y|default(params.X)|float)|min %}
    SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={corner_speed}
  {% else %}
    SET_VELOCITY_LIMIT
  {% endif %}

# Make BambuStudio happy
[gcode_macro _G17]
gcode:

[gcode_macro _M981]
gcode:

[gcode_macro _M1003]
gcode:

################################################################

[mcu rpi]
serial: /tmp/klipper_host_mcu

[temperature_sensor raspberry_pi]
sensor_type: temperature_host
min_temp: 10
max_temp: 100

[input_shaper]
shaper_freq_x: 52
shaper_freq_y: 56
shaper_type: mzv

[adxl345]
cs_pin: rpi:None

[resonance_tester]
accel_chip: adxl345
probe_points:
    100,100,20  # an example

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [skew_correction my_skew_profile]
#*# xy_skew = -0.000702989594323
#*# xz_skew = 0.0
#*# yz_skew = 0.0
#*#
#*# [endstop_phase stepper_z]
#*# trigger_phase = 16/64
#*#
#*# [bed_mesh PEI_260H_100B]
#*# version = 1
#*# points =
#*# 	0.135000, 0.092500, 0.112500, -0.015000, 0.105000
#*# 	0.007500, 0.010000, 0.037500, -0.002500, 0.085000
#*# 	0.035000, -0.005000, 0.000000, -0.030000, 0.062500
#*# 	0.005000, -0.040000, -0.015000, -0.027500, 0.080000
#*# 	0.007500, -0.030000, -0.020000, -0.002500, 0.087500
#*# tension = 0.2
#*# min_x = 0.0
#*# algo = lagrange
#*# y_count = 5
#*# mesh_y_pps = 3
#*# min_y = 5.0
#*# x_count = 5
#*# max_y = 170.0
#*# mesh_x_pps = 3
#*# max_x = 190.0
#*#
#*# [bed_mesh PEI_Cold]
#*# version = 1
#*# points =
#*# 	  0.050000, 0.047500, 0.070000, -0.070000, 0.035000
#*# 	  0.055000, 0.050000, 0.130000, -0.015000, 0.050000
#*# 	  0.102500, 0.032500, 0.000000, -0.042500, 0.042500
#*# 	  0.070000, 0.027500, 0.010000, -0.030000, 0.050000
#*# 	  0.110000, 0.035000, 0.022500, 0.022500, 0.105000
#*# tension = 0.2
#*# min_x = 0.0
#*# algo = lagrange
#*# y_count = 5
#*# mesh_y_pps = 3
#*# min_y = 5.0
#*# x_count = 5
#*# max_y = 170.0
#*# mesh_x_pps = 3
#*# max_x = 190.0
